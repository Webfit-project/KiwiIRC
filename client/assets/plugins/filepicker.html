<style>
    #kiwi .controlbox .input_tools .tool {
        display: inline;
        float: right;
        margin: 0;
        position: relative;
        width: 13px;
    }
    #kiwi .controlbox .input_tools #upload {
        position: absolute;
        right: 0.5em;
    }
</style>
<script type="text/javascript">
    // File picker plugin
    // Author: https://github.com/pepijndevos/
    
    $script("//api.filepicker.io/v1/filepicker.js", function () {
        var control = kiwi.components.ControlInput();

        filepicker.setKey("AFDstUhzT9SW0Kl2yS7Egz");

        function uploaded(files) {
            var area = $("#kiwi .controlbox textarea");

            for (var i = 0; files.length>i; i++) {
                var f = files[i];
                area.val(area.val() + " " + f.url + "+" + encodeURIComponent(f.filename));
            }
        }

        filepicker.makeDropPane($("#kiwi .panels")[0], { onSuccess: uploaded });

        var $icon = $('<a id="upload" class="upload" title="Send File"><i class="fa fa-upload"></i></a>');
        $icon.click(function () { filepicker.pickMultiple(uploaded); });

        control.addPluginIcon($icon);
    });
</script>
